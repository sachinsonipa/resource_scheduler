{% extends 'base.html' %}
{% block content %}

<form method="get" class="row g-2 mb-3">
  <div class="col-sm-4">
    <input type="text" name="search" value="{{ search }}" placeholder="Search" class="form-control">
  </div>
  <div class="col-sm-3">
    <select name="resource" class="form-select">
      <option value="">All Resources</option>
      {% for r in resources %}
        <option value="{{ r.ResourceId }}" {% if r.ResourceId == selected_resource %}selected{% endif %}>{{ r.ResourceName }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-sm-3">
    <select name="sort" class="form-select">
      <option value="">Sort By</option>
      <option value="start" {% if sort=='start' %}selected{% endif %}>Start</option>
      <option value="end" {% if sort=='end' %}selected{% endif %}>End</option>
      <option value="resource" {% if sort=='resource' %}selected{% endif %}>Resource</option>
    </select>
  </div>
  <div class="col-sm-2">
    <button type="submit" class="btn btn-primary w-100">Apply</button>
  </div>
</form>

<table class="table table-bordered table-striped mt-3">
  <tr>
    <th>ID</th><th>Project</th><th>Est</th>
    <th>Start</th><th>End</th>
    <th>Resource</th><th>Assigned At</th><th>Remaining</th><th>Status</th><th>Action</th>
  </tr>
  {% for w in workitems %}
  <tr>
    <td>{{ w.WorkId }}</td>
    <td>{{ w.ProjectName }}</td>
    <td>{{ w.Estimate }}</td>
    <td>{{ w.ProjStart }}</td>
    <td>{{ w.ProjEnd }}</td>
    <td>{{ w.ResourceName or w.AssignedResource }}</td>
    <td>{{ w.AssignDatetime }}</td>
    <td>{{ w.RemainingHours }}</td>
    <td>{{ w.Status }}</td>
    <td class="d-flex gap-1">
      <a class="btn btn-sm btn-secondary" href="{{ url_for('edit_workitem', work_id=w.WorkId) }}">Edit</a>
      <a class="btn btn-sm btn-info" href="{{ url_for('add_note', work_id=w.WorkId) }}">Note</a>
      <a class="btn btn-sm btn-warning" href="{{ url_for('pause_workitem', work_id=w.WorkId) }}">Pause</a>
      <a class="btn btn-sm btn-success" href="{{ url_for('complete_workitem', work_id=w.WorkId) }}">Complete</a>
      <a class="btn btn-sm btn-danger" href="{{ url_for('delete_workitem', work_id=w.WorkId) }}" onclick="return confirm('Delete this item?');">Delete</a>
    </td>
  </tr>
  {% endfor %}
</table>
{% endblock %}
